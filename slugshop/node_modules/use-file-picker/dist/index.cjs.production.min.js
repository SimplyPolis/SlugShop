"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_rollupPluginBabelHelpers-7d3a169b.js"),n=require("react"),r=require("file-selector");function t(t){var l=t.accept,i=void 0===l?"*":l,o=t.multiple,c=void 0===o||o,a=t.readAs,u=void 0===a?"Text":a,s=t.readFilesContent,f=void 0===s||s,d=t.validators,p=void 0===d?[]:d,v=t.initializeWithCustomParameters,F=n.useState([]),m=F[0],y=F[1],h=n.useState([]),C=h[0],S=h[1],x=n.useState([]),g=x[0],b=x[1],k=n.useState(!1),_=k[0],R=k[1],P=function(e){var n=e.onFilesSelected,r=e.onFilesSuccessfullySelected,t=e.onFilesRejected,l=e.onClear,i=e.validators;return{onFilesSelected:function(e){null==n||n(e),null==i||i.forEach((function(n){n.onFilesSelected(e)}))},onFilesSuccessfullySelected:function(e){null==r||r(e),null==i||i.forEach((function(n){n.onFilesSuccessfullySelected(e)}))},onFilesRejected:function(e){null==t||t(e),null==i||i.forEach((function(n){n.onFilesRejected(e)}))},onClear:function(){null==l||l(),null==i||i.forEach((function(e){null==e.onClear||e.onClear()}))}}}(t),E=P.onFilesSelected,j=P.onFilesSuccessfullySelected,w=P.onFilesRejected,A=P.onClear,B=n.useCallback((function(){y([]),S([]),b([])}),[]),M=n.useCallback((function(){B(),null==A||A()}),[B,A]),T=function(n){return new Promise(function(){var r=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(l,i){var o,c;return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:(o=new FileReader)["readAs"+u].call(o,n),c=function(n){var r=e._extends({},(e._objectDestructuringEmpty(n),n));i(e._extends({},r))},o.onload=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(){return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(p.map((function(e){return e.validateAfterParsing(t,n,o).catch((function(e){return Promise.reject(c(e))}))}))).then((function(){return l(e._extends({},n,{content:o.result,name:n.name,lastModified:n.lastModified}))})).catch((function(){})));case 1:case"end":return r.stop()}}),r)}))),o.onerror=function(){c({name:"FileReaderError",readerError:o.error,causedByFile:n})};case 6:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}())};return{openFilePicker:function(){!function(e,n,r,t){var l=document.createElement("input");l.style.display="none",document.body.appendChild(l),l.type="file","*"!==e&&(l.accept=e),l.multiple=n,l.addEventListener("change",(function(e){r(e),document.body.removeChild(l)})),t&&t(l),l.dispatchEvent(new MouseEvent("click"))}(i instanceof Array?i.join(","):i,c,function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(l){var i,o,c,a,u,s;return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(),o=(i=l.target).files?Array.from(i.files):[],R(!0),e.next=6,Promise.all(p.map((function(e){return e.validateBeforeParsing(t,o).catch((function(e){return Array.isArray(e)?e:[e]}))})));case 6:if(c=e.sent.flat(1).filter(Boolean),y(o),b(c),!c.length){e.next=15;break}return R(!1),y([]),null==w||w({errors:c}),null==E||E({errors:c}),e.abrupt("return");case 15:if(f){e.next=19;break}return R(!1),null==E||E({plainFiles:o,filesContent:[]}),e.abrupt("return");case 19:return e.next=21,r.fromEvent(l);case 21:return a=e.sent,u=[],e.next=25,Promise.all(a.map((function(e){return T(e).catch((function(e){u.push.apply(u,Array.isArray(e)?e:[e])}))})));case 25:if(s=e.sent,R(!1),!u.length){e.next=34;break}return y([]),S([]),b((function(e){return[].concat(e,u)})),null==w||w({errors:u}),null==E||E({errors:c.concat(u)}),e.abrupt("return");case 34:S(s),y(o),b([]),null==j||j({filesContent:s,plainFiles:o}),null==E||E({plainFiles:o,filesContent:s});case 39:case"end":return e.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),v)},filesContent:C,errors:g,loading:_,plainFiles:m,clear:M}}exports.useFilePicker=t,exports.useImperativeFilePicker=function(r){var l=r.onFilesSelected,i=r.onFilesSuccessfullySelected,o=r.validators,c=r.onFileRemoved,a=n.useState([]),u=a[0],s=a[1],f=n.useState([]),d=f[0],p=f[1],v=t(e._extends({},r,{onFilesSelected:function(e){var n;if(l)return null!=(n=e.errors)&&n.length?l(e):void l({errors:void 0,plainFiles:[].concat(u,e.plainFiles||[]),filesContent:[].concat(d,e.filesContent||[])})},onFilesSuccessfullySelected:function(e){s((function(n){return n.concat(e.plainFiles)})),p((function(n){return n.concat(e.filesContent)})),i&&i({plainFiles:[].concat(u,e.plainFiles||[]),filesContent:[].concat(d,e.filesContent||[])})}})),F=v.openFilePicker,m=v.loading,y=v.errors,h=v.clear,C=n.useCallback((function(){h(),s([]),p([])}),[h]),S=n.useCallback((function(e){p((function(n){return[].concat(n.slice(0,e),n.slice(e+1))})),s((function(n){var r=n[e];return null==o||o.forEach((function(n){return null==n.onFileRemoved?void 0:n.onFileRemoved(r,e)})),null==c||c(r,e),[].concat(n.slice(0,e),n.slice(e+1))}))}),[o,c]),x=n.useCallback((function(e){var n=u.findIndex((function(n){return n===e}));-1!==n&&S(n)}),[S,u]);return{openFilePicker:F,plainFiles:u,filesContent:d,loading:m,errors:y,clear:C,removeFileByIndex:S,removeFileByReference:x}};
//# sourceMappingURL=index.cjs.production.min.js.map
