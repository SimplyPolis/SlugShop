const puppeteer = require('puppeteer')
const cheerio = require('cheerio')

;(async () => {
  const browser = await puppeteer.launch()
  const page = await browser.newPage()


  const doms = []
  await page.setJavaScriptEnabled(false)
  await page.goto('http://127.0.0.1:8080/stages.html')
  const html0 = await page.evaluate(() => {
    return document.documentElement.outerHTML;
  })
  await page.setJavaScriptEnabled(true)

  await page.goto('http://127.0.0.1:8080/stages.html')
  const html1 = await page.evaluate(() => {
    return document.documentElement.outerHTML;
  })
  doms.push(cheerio.load(html1))
  await page.goto('http://127.0.0.1:8080/stages.html', {
    waitUntil: 'networkidle2',
  })
  const html2 = await page.evaluate(() => {
    return document.documentElement.outerHTML;
  })
  if (html1 !== html2) {
    doms.push(cheerio.load(html2))
  }
  await browser.close()
  console.log(doms.length, 'DOMS');
  console.log(doms[0]('p').length);
  console.log(doms[1]('p').length);

  console.log(doms[0]('p.really-loaded').length);
  console.log(doms[1]('p.really-loaded').length);

  console.log(doms[0]('p.xhr-loaded').length);
  console.log(doms[1]('p.xhr-loaded').length);
  // console.log(doms[0]('p.really-loaded'));
  // console.log(doms[1]('p.really-loaded'));


})()
