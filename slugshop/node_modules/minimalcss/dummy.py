import os
from django.core.wsgi import get_wsgi_application
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "buildhub.settings")
get_wsgi_application()

from buildhub.main.models import *
# build = json.load(open('buildhub.json'))
# print(Build.insert(build=build))

import time
import json
from glob import glob
times = []
news = 0
files = glob('buildhub_jsons/*.json')
import random
random.shuffle(files)

builds=[]
for fn in files:
    builds.append(json.load(open(fn)))

t0 = time.time()
inserted = Build.bulk_insert(builds)
t1 = time.time()
print('inserted:', inserted)
times.append(t1 - t0)
#     t0 = time.time()
#     inserted = Build.insert(build=build)
#     t1 = time.time()
#     if inserted:
#         news += 1
#     # if inserted:
#     #     print("New")
#     times.append(t1 - t0)


def f(s):
    ms = s * 1000
    return f"{ms:.2f}ms"

import statistics
# print("NEW   ", news)
print("COUNT ", len(times))
print("SUM   ", f(sum(times)))
print("MEAN  ", f(statistics.mean(times)))
print("mean  ", f(statistics.mean(times) / len(builds)))
print("MEDIAN", f(statistics.median(times)))
print("median", f(statistics.median(times) / len(builds)))
